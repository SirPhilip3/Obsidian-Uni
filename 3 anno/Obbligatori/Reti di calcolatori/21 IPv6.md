---
publish: true
creation: 2024-12-29T11:12:00
---
# ICMP ( Internet Control Message Protocol )

**ICMP** è un protocollo di *segnalazione* che tipicamente non porta informazioni 

Trasporta messaggi di errore e relativi allo stato della rete 

>[!note] 
>**IP** dipende da **ICMP** per fare *error handling*
>**ICMP** usa i datagrammi **IP** per trasportare un messaggio 

>[!note] 
>**ICMP** non usa alcun [[Transport Layer]] protocol , fa affidamento direttamente sul [[07 Network Layer]]

## ICMP Header

![[Pasted image 20241229112404.png]]

Un pacchetto **ICMP** è generato quando un'altro pacchetto produce un evento anomalo

`Type` e `Code` identificano il tipo di evento 
>[!example] 
>+ *Destination* ( 3 ) : 
>	La destinazione non è intradabile 
>	La porta di destinazione è chiusa 
>	Necessitiamo la frammentazione ( `Dont Fragment` ad 1 o l'**MTU** non è abbastanza grande per il pacchetto )
>+ *Redirect* ( 5 ) 
>	Il *router* notifica che c'è un next hop migliore ( generalmente ignorato )
>+ *TTL exceeded* ( 11 )
>	Il pacchetto è rimasto bloccato in un loop
>+ *echo request ( 8 ) / reply ( 0 )*
>	Rispondi se esisti

I pacchetti **ICMP** sono trattati come tutti gli altri , solo che se un pacchetto **ICMP** causa un errore non viene generato un altro **ICMP** per segnalare questo errore 
### ICMP usage

#### ping

Un *ping* è una *echo request* , questo pacchetto **ICMP** genera una risposta da parte del *server* se questo è raggiungibile e acceso 

In pratica possiamo capire se un certo *server* o *IP* è raggiungibile e tastare la sua latenza

>[!example] 
>
>```bash
>$ ping -c 5 8.8.8.8
>PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data .
>64 bytes from 8.8.8.8: icmp_seq=1 ttl=115 time=10.3 ms
>64 bytes from 8.8.8.8: icmp_seq=2 ttl=115 time=10.0 ms
>64 bytes from 8.8.8.8: icmp_seq=3 ttl=115 time=10.5 ms
>64 bytes from 8.8.8.8: icmp_seq=4 ttl=115 time=10.7 ms
>64 bytes from 8.8.8.8: icmp_seq=5 ttl=115 time=11.1 ms
>
>--- 8.8.8.8 ping statistics ---
>5 packets transmitted , 5 received , 0% packet loss , time 4007 ms
>rtt min / avg / max / mdev = 10.012/10.526/11.077/0.366 ms
>```

>[!note] 
>Un pacchetto di *echo request/reply* per **ICMP** è fatto nel seguente modo :
![[Pasted image 20241229114139.png]]
#### traceroute

Invia un *pacchetto* alla destinazione con **TTL=1** 
>[!note] 
>Il pacchetto non necessariamente deve essere **ICMP** , generalmente viene usato un pacchetto **UDP**

Al primo *hop* il *router* risponderà con un **ICMP** *TTL exceeded* , questo conterrà l'**IP** del router che ha risposto , in questo modo se ripetiamo questo processo per **TTL** incrementali fino alla destinazione possiamo fare una stima del numero di *hop* che un pacchetto deve fare per raggiungere quella destinazione

>[!warning] 
>Gli *host* non sono costretti a generare pacchetti **ICMP** 

>[!example] 
>```bash
>$ traceroute 8.8.8.8
>traceroute to 8.8.8.8 (8.8.8.8) , 30 hops max , 60 byte packets
>1 F32ZY.homenet.telecomitalia.it (192.168.1.1) 3.428 ms * *
>2 * * *
>3 172.17.104.116 (172.17.104.116) 10.445 ms 11.438 ms 11.401 ms
>4 172.17.104.100 (172.17.104.100) 13.361 ms 172.17.105.174                   (172.17.105.174) 13.325 ms 172.17.105.70 (172.17.105.70) 13.283 ms
>5 172.19.184.70 (172.19.184.70) 16.763 ms 172.19.184.64                      (172.19.184.64) 18.310 ms 19.808 ms
>6 172.19.177.20 (172.19.177.20) 19.736 ms 172.19.177.14                      (172.19.177.14) 10.250 ms 172.19.177.20 (172.19.177.20) 11.073 ms
>7 ae48.milano11.mil.seabone.net (195.22.192.144) 10.976 ms ae48.milano50.mil.seabone.net (195.22.196.170) 10.852 ms ae48.milano11.mil.seabone.net (195.22.192.144) 10.835 ms
>8 72.14.216.154 (72.14.216.154) 12.783 ms 72.14.209.236 (72.14.209.236) 12.569 ms *
>9 * * *
>10 dns.google (8.8.8.8) 9.721 ms 10.133 ms 10.975 ms
>```

# IPv6

